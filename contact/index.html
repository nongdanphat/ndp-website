<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Liên hệ - NDP</title>
    <link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico" />
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- ============================================ -->
    <!-- CẤU HÌNH - Thay đổi URL bên dưới -->
    <!-- ============================================ -->
    <script>
      const CONTACT_SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbwV5mUyGuBGVlmapkFNesXpOpTTOidO2BTRiAlW_bNWDd91bvv6QivOZ_1qioeyV0g9/exec";
    </script>
  </head>
  <body class="bg-gray-100 text-gray-900">
    <!-- Header placeholder - will be loaded dynamically -->
    <div id="header-placeholder"></div>

    <!-- Main Content -->
    <main class="min-h-screen py-12">
      <div class="container mx-auto px-4 max-w-6xl">
        <div class="grid md:grid-cols-2 gap-12 items-start">
          <!-- Contact Information -->
          <div class="pt-8">
            <h1
              class="text-4xl md:text-5xl font-bold text-gray-900 mb-6 leading-tight"
            >
              Liên hệ <span class="text-[#AB7E31]">Nông Dân Phát</span>
            </h1>
            <p class="text-base md:text-lg text-gray-600 mb-6 leading-relaxed">
              Bạn có thể liên hệ với Nông Dân Phát tại đây. Chúng tôi luôn sẵn
              sàng trao đổi và rất vui được kết nối cùng bạn.
            </p>
            <p class="text-base md:text-lg text-gray-600 mb-8 leading-relaxed">
              Nếu bạn muốn chia sẻ góc nhìn hoặc đóng góp ý kiến, vui lòng truy
              cập trang
              <a
                href="/insights/index.html"
                class="text-[#AB7E31] hover:text-[#BE8F2B] font-medium underline"
                >Chia sẻ & Xin ý kiến</a
              >.
            </p>
            <div class="space-y-6">
              <div>
                <p class="text-sm text-gray-600 mb-1">Email:</p>
                <p class="text-base font-bold text-gray-900">info@ndphat.vn</p>
              </div>
              <!-- <div>
                <p class="text-sm text-gray-600 mb-1">Điện thoại:</p>
                <p class="text-base font-bold text-gray-900">+84 123 456 789</p>
              </div> -->
              <div>
                <p class="text-sm text-gray-600 mb-1">Thời gian làm việc</p>
                <p class="text-base font-bold text-gray-900">
                  Thứ Hai – Thứ Sáu, 9:00 – 18:00 (GMT+7)
                </p>
              </div>
            </div>
          </div>

          <!-- Contact Form -->
          <div class="bg-white p-8 rounded-3xl">
            <form id="contact-form" class="space-y-4">
              <div>
                <label
                  for="name"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Họ và tên <span class="text-red-500">*</span></label
                >
                <input
                  type="text"
                  id="name"
                  name="name"
                  required
                  class="w-full px-4 py-2 border border-gray-300 rounded-3xl focus:outline-none focus:ring-2 focus:ring-[#AB7E31] focus:border-transparent"
                />
              </div>
              <div>
                <label
                  for="email"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Email <span class="text-red-500">*</span></label
                >
                <input
                  type="email"
                  id="email"
                  name="email"
                  required
                  class="w-full px-4 py-2 border border-gray-300 rounded-3xl focus:outline-none focus:ring-2 focus:ring-[#AB7E31] focus:border-transparent"
                />
              </div>
              <div>
                <label
                  for="phone"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Số điện thoại <span class="text-red-500">*</span></label
                >
                <input
                  type="tel"
                  id="phone"
                  name="phone"
                  required
                  inputmode="numeric"
                  pattern="[0-9]*"
                  class="w-full px-4 py-2 border border-gray-300 rounded-3xl focus:outline-none focus:ring-2 focus:ring-[#AB7E31] focus:border-transparent"
                />
              </div>
              <div>
                <label
                  for="message"
                  class="block text-sm font-medium text-gray-700 mb-1"
                  >Vui lòng mô tả ngắn gọn nội dung bạn muốn trao đổi.
                  <span class="text-red-500">*</span></label
                >
                <textarea
                  id="message"
                  name="message"
                  rows="4"
                  required
                  class="w-full px-4 py-2 border border-gray-300 rounded-3xl focus:outline-none focus:ring-2 focus:ring-[#AB7E31] focus:border-transparent"
                ></textarea>
              </div>
              <div
                id="contact-message"
                class="hidden mt-4 p-4 rounded-3xl"
              ></div>
              <div class="flex items-start gap-3">
                <input
                  type="checkbox"
                  id="consent-checkbox"
                  name="consent"
                  required
                  class="mt-1 rounded border-gray-300 text-[#AB7E31] cursor-pointer custom-checkbox"
                />
                <label
                  for="consent-checkbox"
                  class="text-sm text-gray-700 cursor-pointer leading-relaxed"
                >
                  Tôi đồng ý cho
                  <span class="text-[#AB7E31] font-semibold"
                    >Nông Dân Phát</span
                  >
                  thu thập và sử dụng thông tin tôi cung cấp để liên hệ tư vấn
                  và cung cấp thông tin liên quan.
                </label>
              </div>
              <div class="flex justify-end">
                <button
                  type="submit"
                  id="contact-submit-button"
                  class="bg-gradient-to-r from-[#AB7E31] to-[#BE8F2B] text-white py-3 px-6 rounded-3xl hover:shadow-xl transition-all duration-300 ease-in-out transform hover:scale-105 font-medium shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                  disabled
                >
                  Gửi yêu cầu
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer placeholder - will be loaded dynamically -->
    <div id="footer-placeholder"></div>

    <!-- Load header and footer -->
    <script src="/load-header-footer.js"></script>

    <!-- Custom Checkbox Styles -->
    <style>
      .custom-checkbox {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        background-color: white;
        border: 2px solid #d1d5db;
        border-radius: 4px;
        position: relative;
        cursor: pointer;
        transition: all 0.2s ease;
        width: 20px;
        height: 20px;
        min-width: 20px;
        min-height: 20px;
        outline: none;
        box-shadow: none;
      }

      .custom-checkbox:checked {
        background-color: #ab7e31;
        border-color: #ab7e31;
      }

      .custom-checkbox:checked::after {
        content: "";
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        width: 12px;
        height: 12px;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='white'%3E%3Cpath fill-rule='evenodd' d='M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z' clip-rule='evenodd'/%3E%3C/svg%3E");
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
      }

      .custom-checkbox:hover {
        border-color: #ab7e31;
      }

      .custom-checkbox:focus {
        outline: none !important;
        box-shadow: none !important;
        border-color: #ab7e31;
      }

      .custom-checkbox:focus-visible {
        outline: none !important;
        box-shadow: none !important;
      }
    </style>

    <!-- JavaScript -->
    <script>
      // Xử lý input số điện thoại - chỉ nhận số
      const phoneInput = document.getElementById("phone");
      phoneInput.addEventListener("input", function (e) {
        let value = e.target.value.replace(/\D/g, "");
        if (value.length > 11) {
          value = value.substring(0, 11);
        }
        e.target.value = value;
      });

      // Form submission
      const contactForm = document.getElementById("contact-form");
      const contactSubmitButton = document.getElementById(
        "contact-submit-button"
      );
      const contactMessage = document.getElementById("contact-message");
      const consentCheckbox = document.getElementById("consent-checkbox");

      // Enable/disable submit button based on checkbox
      consentCheckbox.addEventListener("change", function () {
        contactSubmitButton.disabled = !this.checked;
      });

      function showContactMessage(text, type) {
        contactMessage.textContent = text;
        contactMessage.className = `mt-4 p-4 rounded-3xl ${
          type === "error"
            ? "bg-red-50 text-red-700"
            : "bg-green-50 text-green-700"
        }`;
        contactMessage.classList.remove("hidden");
        setTimeout(() => {
          contactMessage.classList.add("hidden");
        }, 5000);
      }

      contactForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        if (CONTACT_SCRIPT_URL === "YOUR_CONTACT_FORM_SCRIPT_URL") {
          showContactMessage(
            "Vui lòng cấu hình CONTACT_SCRIPT_URL trong code.",
            "error"
          );
          return;
        }

        contactSubmitButton.disabled = true;
        contactSubmitButton.textContent = "Đang gửi...";

        // Lấy số điện thoại và format
        let phoneValue = document
          .getElementById("phone")
          .value.replace(/\D/g, "");
        phoneValue = phoneValue || "";

        const formData = {
          name: document.getElementById("name").value,
          email: document.getElementById("email").value,
          phone: phoneValue,
          message: document.getElementById("message").value,
          formType: "contact", // Phân biệt form từ trang Contact
        };

        try {
          // Sử dụng form submission với iframe ẩn để tránh CORS
          const iframe = document.createElement("iframe");
          iframe.name = "hidden-contact-iframe-" + Date.now();
          iframe.style.position = "fixed";
          iframe.style.left = "-9999px";
          iframe.style.top = "-9999px";
          iframe.style.width = "1px";
          iframe.style.height = "1px";
          iframe.style.border = "none";
          iframe.style.opacity = "0";
          iframe.style.pointerEvents = "none";

          document.body.appendChild(iframe);

          const hiddenForm = document.createElement("form");
          hiddenForm.method = "POST";
          hiddenForm.action = CONTACT_SCRIPT_URL;
          hiddenForm.target = iframe.name;
          hiddenForm.style.display = "none";

          // Thêm dữ liệu vào form
          Object.keys(formData).forEach((key) => {
            const input = document.createElement("input");
            input.type = "hidden";
            input.name = key;
            input.value = formData[key];
            hiddenForm.appendChild(input);
          });

          document.body.appendChild(hiddenForm);

          let isCompleted = false;

          const handleSuccess = () => {
            if (isCompleted) return;
            isCompleted = true;

            showContactMessage(
              "Tin nhắn đã được gửi thành công! Chúng tôi sẽ liên hệ với bạn sớm nhất.",
              "success"
            );
            contactForm.reset();
            consentCheckbox.checked = false;
            contactSubmitButton.disabled = true;

            setTimeout(() => {
              if (hiddenForm.parentNode) {
                document.body.removeChild(hiddenForm);
              }
              if (iframe.parentNode) {
                document.body.removeChild(iframe);
              }
            }, 2000);

            contactSubmitButton.disabled = false;
            contactSubmitButton.textContent = "Gửi yêu cầu";
          };

          const timeoutId = setTimeout(() => {
            handleSuccess();
          }, 2000);

          hiddenForm.submit();

          iframe.onload = function () {
            clearTimeout(timeoutId);
            handleSuccess();
          };
        } catch (error) {
          console.error("Form submission error:", error);
          showContactMessage(
            "Có lỗi xảy ra khi gửi tin nhắn. Vui lòng thử lại sau.",
            "error"
          );
          contactSubmitButton.disabled = false;
          contactSubmitButton.textContent = "Gửi yêu cầu";
        }
      });
    </script>
  </body>
</html>
